<!doctype html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>資料庫 - 樂透遊戲</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css">
    <link rel="stylesheet" href="/static/main.css">

  </head>

  <body>

    <div class="container">
      <h1 class="text-header">資料庫</h1>

      <h2 id="pycode">程式碼</h2>
      <pre>
          <code class="python">
            class Customer():
                import os
                import sqlite3
                from random import randint, sample
                #連接資料庫
                conn = sqlite3.connect('lottery.db')
                cur = conn.cursor()
                lottery_numbers = list(range(1, 19))
                def show_menu():
                    pct = '◎' * 18
                    print('''
                    {}
                    1. 購買大樂透
                    2. 中獎查詢
                    e. 離開       
                    {}
                    '''.format(pct, pct))

                def select_prize(db_cur):
                    db_cur.execute("SELECT MAX(TERM) FROM TERM")
                    new_term = db_cur.fetchone()[0]
                    term = input('搜尋哪一期 (n 表示最新開獎期別)?')
                    if term == 'n':
                        # 最新開獎期別與目前期別差一期
                        term = new_term-1
                    db_cur.execute("SELECT * FROM LOTTERY WHERE TERM=? AND CUSTOMER_ID=? AND RESULT<>'NO' ", (term, 1))
                    prize = db_cur.fetchall()
                    for p in prize:
                        print(p)
                    
                def insert_random_lottery(db_cur, lottery, term, customer_id):
                    for i in range(lottery):
                       # 新增彩券
                        db_cur.execute("SELECT COUNT(*) FROM LOTTERY WHERE TERM=?", (term,))
                        lottery_id = db_cur.fetchone()[0] +1
                        row_data = [term, customer_id, lottery_id]
                        row_data.extend(sample(lottery_numbers, 6))
                        row_data.extend(['R', '', 0])
                        print(row_data)
                        db_cur.execute("INSERT INTO LOTTERY VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)", tuple(row_data))
                        conn.commit()
                    print()

                def buy_lotteries(db_cur):
                    while True:
                        lottery = input('How many lotteries (quit)? ').lower()

                        # 查詢目前為止最新期別
                        db_cur.execute("SELECT MAX(TERM) FROM TERM")
                        term = db_cur.fetchone()[0]

                        if lottery == 'quit':
                            break
                        q1 = int(input('1.電腦選號 2.自己選號'))
                        # 使用者購買彩券
                        if q1 == 1:
                            insert_random_lottery(db_cur, int(lottery), term, 1)
                        elif q1 == 2:
                            print('第 1 位顧客')
                            for h in range(int(lottery)):
                                lo_num = []
                                for i in range(1, 7):
                                    while True:
                                        your_num = int(input('{}號數字'.format(i)))
                                        if your_num in lo_num:
                                            print('請重新輸入')
                                            continue
                                        if your_num not in lo_num:
                                            lo_num.append(your_num)
                                            break
                                db_cur.execute("SELECT COUNT(*) FROM LOTTERY WHERE TERM=?", (term,))
                                lottery_ID = db_cur.fetchone()[0] +1
                                row_data = (term, 1, lottery_ID, lo_num[0], lo_num[1], lo_num[2], lo_num[3], lo_num[4], lo_num[5], 'C', '', 0)
                                db_cur.execute("INSERT INTO LOTTERY VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)", row_data)
                                conn.commit()
                                print(row_data)

                        # 模擬其他顧客購買彩券
                        # 其他顧客人數
                        other_people = randint(5, 15)
                        for i in range(other_people):
                            other_lottery = randint(1, 5)
                            # 模擬產生顧客編號
                            customer_id = randint(2, 30)
                            insert_random_lottery(db_cur, other_lottery, term, customer_id)

            while True:
                show_menu()
                opt = input('>>').lower()
                if opt not in ('1', '2', 'e'):
                    print('O.O請重新輸入O.O')
                if opt == '1':
                    buy_lotteries(cur)
                elif opt == '2':
                    select_prize(cur)
                elif opt == 'e':
                    break
          </code>
      </pre>

      <h2 id="schema">資料表</h2>
      <h3>彩券對獎表 <span class="text-primary">LOTTERY</span></h3>
        <div class="col-md-12">
            <table class="table table-bordered table-schema">
                <thead class="thead-light">
                    <tr>
                      <th>欄位</th>
                      <th>資料型態</th>
                      <th>名稱</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                      <td>TERM</td>
                      <td>integer</td>
                      <td>期別</td>
                    </tr>
                    <tr>
                      <td>CUSTOMER_ID</td>
                      <td>integer</td>
                      <td>顧客編號</td>
                    </tr>
                    <tr>
                      <td>LOTTERY_ID</td>
                      <td>integer</td>
                      <td>彩券編號</td>
                    </tr>
                    <tr>
                      <td>NUM1~6</td>
                      <td>integer</td>
                      <td>選號 1~6</td>
                    </tr>
                    <tr>
                      <td>METHOD</td>
                      <td>text</td>
                      <td>選法 (自己選號 / 電腦選號)</td>
                    </tr>
                    <tr>
                      <td>RESULT</td>
                      <td>text</td>
                      <td>對獎結果 (頭獎、貳獎、參獎、肆獎)</td>
                    </tr>
                    <tr>
                      <td>BONUS</td>
                      <td>integer</td>
                      <td>獎金</td>
                    </tr>
                </tbody>
            </table>
        </div>
      
    </div>
    
    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/static/holder.min.js"></script>
  </body>
</html>